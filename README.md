# IT4062_The-price-is-right-Game

**IT4062: Network Programming - Project Game "HÃ£y Chá»n GiÃ¡ ÄÃºng"**

Dá»± Ã¡n Ä‘Æ°á»£c phÃ¡t triá»ƒn báº±ng C/C++ sá»­ dá»¥ng socket programming (POSIX socket API) Ä‘á»ƒ xÃ¢y dá»±ng trÃ² chÆ¡i máº¡ng Ä‘a ngÆ°á»i chÆ¡i theo format chÆ°Æ¡ng trÃ¬nh "The Price is Right" (HÃ£y Chá»n GiÃ¡ ÄÃºng). 

## ğŸ¯ Äáº·c Ä‘iá»ƒm ká»¹ thuáº­t

- **Client**: Qt 5.15+ vá»›i QML/QtQuick (C++ backend + C socket layer)
- **Server**: Pure C vá»›i POSIX sockets, pthread, MySQL C API
- **Protocol**: Custom Message-based protocol qua TCP
- **Database**: MySQL Server 8.0+ (há»— trá»£ cáº£ Ubuntu Native vÃ  WSL2)
- **Platform**: Linux (Ubuntu 20.04+, WSL2)

## ğŸ“ Cáº¥u trÃºc dá»± Ã¡n

```
IT4062_The-price-is-right-Game/
â”œâ”€â”€ client/                      # á»¨ng dá»¥ng client (Qt/QML)
â”‚   â”œâ”€â”€ headers/
â”‚   â”‚   â”œâ”€â”€ BackEnd.h           # Qt C++ wrapper class (QObject)
â”‚   â”‚   â””â”€â”€ Utils.h             # C socket functions declarations
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.cpp            # Entry point, register QML types
â”‚   â”‚   â”œâ”€â”€ BackEnd.cpp         # Backend implementation
â”‚   â”‚   â””â”€â”€ Utils.c             # Socket implementations (connect, signup, etc.)
â”‚   â”œâ”€â”€ qml/
â”‚   â”‚   â”œâ”€â”€ main.qml            # Main window (800x600)
â”‚   â”‚   â”œâ”€â”€ HomeGuest.qml       # Home screen vá»›i sunburst animation
â”‚   â”‚   â””â”€â”€ RegisterPage.qml    # Signup form
â”‚   â”œâ”€â”€ resources/
â”‚   â”‚   â””â”€â”€ qml.qrc             # Qt resource file
â”‚   â”œâ”€â”€ client.pro              # qmake project file
â”‚   â””â”€â”€ Makefile                # Generated by qmake
â”‚
â”œâ”€â”€ server/                      # Server application (Pure C)
â”‚   â”œâ”€â”€ include/
â”‚   â”‚   â”œâ”€â”€ server.h            # Server declarations, Message protocol
â”‚   â”‚   â””â”€â”€ database.h          # MySQL wrapper functions
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.c              # Entry point
â”‚   â”‚   â”œâ”€â”€ server.c            # Socket server, threading, client handling
â”‚   â”‚   â””â”€â”€ database.c          # MySQL connection & queries
â”‚   â”œâ”€â”€ config                  # Server configuration
â”‚   â”œâ”€â”€ Makefile                # Build configuration
â”‚   â””â”€â”€ bin/                    # Build output directory
â”‚       â””â”€â”€ server              # Executable
â”‚
â”œâ”€â”€ database/                    # Database schema & seed data
â”‚   â”œâ”€â”€ init.sql                # Table schemas (11 tables)
â”‚   â””â”€â”€ seed_data.sql           # Test users data
â”‚
â””â”€â”€ README.md

```

## ğŸ”§ YÃªu cáº§u há»‡ thá»‘ng

### Dependencies

```bash
# Qt5 development tools
sudo apt install qt5-qmake qtbase5-dev qtdeclarative5-dev

# Qt5 QML runtime modules
sudo apt install qml-module-qtquick2 qml-module-qtquick-controls2 \
                 qml-module-qtquick-layouts qml-module-qtquick-window2

# MySQL client library (for server)
sudo apt install libmysqlclient-dev

# Build tools
sudo apt install gcc g++ make

# MySQL Server
sudo apt install mysql-server
```

### MySQL Server Setup

**Chi tiáº¿t Ä‘áº§y Ä‘á»§ xem file [`database/DATABASE_SETUP.md`](database/DATABASE_SETUP.md)**

#### Quick Setup:

1. **Khá»Ÿi Ä‘á»™ng MySQL**:
   ```bash
   # Ubuntu Native
   sudo systemctl start mysql
   sudo systemctl enable mysql
   
   # WSL2
   sudo service mysql start
   ```

2. **Táº¡o database vÃ  user**:
   ```bash
   cd database
   sudo mysql
   ```
   
   Trong MySQL shell:
   ```sql
   CREATE DATABASE hay_chon_gia_dung CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   
   CREATE USER 'admin'@'localhost' IDENTIFIED WITH mysql_native_password BY '123456';
   CREATE USER 'admin'@'%' IDENTIFIED WITH mysql_native_password BY '123456';
   
   GRANT ALL PRIVILEGES ON hay_chon_gia_dung.* TO 'admin'@'localhost' WITH GRANT OPTION;
   GRANT ALL PRIVILEGES ON hay_chon_gia_dung.* TO 'admin'@'%' WITH GRANT OPTION;
   FLUSH PRIVILEGES;
   
   USE hay_chon_gia_dung;
   SOURCE init.sql;
   SOURCE seed_data.sql;
   
   SELECT COUNT(*) as total_users FROM users;
   exit;
   ```

3. **Verify**: Náº¿u tháº¥y `total_users: 5` â†’ Setup thÃ nh cÃ´ng! âœ…

## ğŸš€ Build & Run

### 1. Build Server

```bash
cd server
make clean && make
```

Output: `bin/server` executable

### 2. Build Client

```bash
cd client
qmake client.pro
make
```

Output: `client` executable

### 3. Run Application

**BÆ°á»›c 1: Khá»Ÿi Ä‘á»™ng MySQL (náº¿u chÆ°a cháº¡y)**
```bash
# Ubuntu Native
sudo systemctl start mysql

# WSL2
sudo service mysql start
```

**BÆ°á»›c 2: Cháº¡y Server**
```bash
cd server
./bin/server
```

Server sáº½:
- Auto-detect MySQL socket path
- Káº¿t ná»‘i MySQL database 'hay_chon_gia_dung' vá»›i user 'admin'
- Listen trÃªn port 5555
- Sáºµn sÃ ng nháº­n connections

Expected output:
```
=== HayChonGiaDung C Server ===
[DB] Detected MySQL socket: /var/run/mysqld/mysqld.sock
[DB] Connected to MySQL database 'hay_chon_gia_dung' as user 'admin'
[DB] Test query OK.
[DB] Current users in DB: 5
[SERVER] Listening on port 5555...
[SERVER] Press Ctrl+C to stop
```

**BÆ°á»›c 3: Cháº¡y Client (terminal khÃ¡c)**
```bash
cd client
./client 127.0.0.1 5555
```

Arguments:
- `127.0.0.1`: Server IP address
- `5555`: Server port

## ğŸ® Chá»©c nÄƒng hiá»‡n táº¡i

### âœ… ÄÃ£ hoÃ n thÃ nh
- [x] Káº¿t ná»‘i client-server qua TCP socket
- [x] Message-based protocol (enum msg_type, struct Message)
- [x] Multi-threaded server (pthread per client connection)
- [x] User registration (SIGNUP)
  - Kiá»ƒm tra username Ä‘Ã£ tá»“n táº¡i
  - Insert user má»›i vÃ o MySQL
  - Response vá»›i SIGNUP_SUCCESS hoáº·c ACCOUNT_EXIST
- [x] UI Registration form
  - Username, Email, Password, Confirm Password fields
  - Agreement checkbox validation
  - Animated sunburst background

### ğŸš§ Äang phÃ¡t triá»ƒn
- [ ] User login 
- [ ] Game logic (chá»n giÃ¡ sáº£n pháº©m)
- [ ] Multiplayer room system

## ğŸ“¡ Message Protocol

Client vÃ  server giao tiáº¿p qua struct `Message`:

```c
enum msg_type {
    DISCONNECT,
    LOGIN, LOGIN_SUCCESS, LOGGED_IN, 
    WRONG_PASSWORD, ACCOUNT_NOT_EXIST, ACCOUNT_BLOCKED,
    SIGNUP, ACCOUNT_EXIST, SIGNUP_SUCCESS,
    CHANGE_PASSWORD, SAME_OLD_PASSWORD, CHANGE_PASSWORD_SUCCESS,
    LOGOUT
};

typedef struct _message {
    enum msg_type type;        // Message type
    char data_type[25];        // "string", "int", etc.
    int length;                // Length of value
    char value[BUFF_SIZE];     // Data payload (e.g., "username password")
} Message;
```

### Signup Flow:
1. Client gá»­i: `{type: SIGNUP, value: "username password"}`
2. Server xá»­ lÃ½: `handle_signup()` â†’ query MySQL
3. Server pháº£n há»“i: `{type: SIGNUP_SUCCESS}` hoáº·c `{type: ACCOUNT_EXIST}`
4. Client hiá»ƒn thá»‹ popup tÆ°Æ¡ng á»©ng

## ğŸ—„ï¸ Database Schema

Database `hay_chon_gia_dung` gá»“m 11 tables:

- **users**: user_id, username, password_hash, email, is_online, created_at, last_login_at
- **products**: product_id, name, actual_price, image_url, category
- **rooms**: room_id, created_by, status, max_players, created_at
- **room_members**: room_id, user_id, joined_at
- **matches**: match_id, room_id, status, started_at, ended_at
- **rounds**: round_id, match_id, round_number, status
- **round_products**: round_product_id, round_id, product_id
- **round_answers**: answer_id, round_id, user_id, guessed_price, is_correct
- **invitations**: invitation_id, from_user_id, to_user_id, room_id, status
- **match_events**: event_id, match_id, event_type, event_data, created_at
- **user_stats**: user_id, total_matches, wins, losses, accuracy_rate

Test users (password: `123456`):
- nhung, duyen, ha, yen, guest1

Database credentials:
- Host: `localhost` hoáº·c `127.0.0.1`
- User: `admin`
- Password: `123456`
- Database: `hay_chon_gia_dung`
- Port: `3306`

## ğŸ› Troubleshooting

### Client khÃ´ng káº¿t ná»‘i Ä‘Æ°á»£c server
```bash
# Kiá»ƒm tra server cÃ³ Ä‘ang cháº¡y khÃ´ng
ps aux | grep server

# Kiá»ƒm tra port 5555
netstat -tuln | grep 5555
```

### Build client lá»—i "qmake: command not found"
```bash
sudo apt install qt5-qmake qtbase5-dev
```

### Server lá»—i "Can't connect to MySQL server"
```bash
# Kiá»ƒm tra MySQL cÃ³ Ä‘ang cháº¡y
sudo systemctl status mysql    # Ubuntu
sudo service mysql status      # WSL

# Náº¿u stopped, khá»Ÿi Ä‘á»™ng láº¡i
sudo systemctl start mysql     # Ubuntu
sudo service mysql start       # WSL

# Kiá»ƒm tra socket file tá»“n táº¡i
ls -l /var/run/mysqld/mysqld.sock
```

### Server lá»—i "Access denied for user 'admin'"
```bash
# Táº¡o láº¡i user admin
sudo mysql -e "
DROP USER IF EXISTS 'admin'@'localhost';
CREATE USER 'admin'@'localhost' IDENTIFIED WITH mysql_native_password BY '123456';
GRANT ALL PRIVILEGES ON hay_chon_gia_dung.* TO 'admin'@'localhost' WITH GRANT OPTION;
FLUSH PRIVILEGES;
"

# Test káº¿t ná»‘i
mysql -u admin -p123456 -e "USE hay_chon_gia_dung; SELECT COUNT(*) FROM users;"
```

### Client lá»—i "Could not find Qt platform plugin wayland"
- Warning nÃ y khÃ´ng áº£nh hÆ°á»Ÿng, client váº«n cháº¡y bÃ¬nh thÆ°á»ng vá»›i X11 fallback

### Port 3306 conflict (náº¿u cÃ³ XAMPP cÅ©)
```bash
# Stop XAMPP MySQL
sudo /opt/lampp/lampp stopmysql

# Hoáº·c kill process
sudo killall mysqld

# Restart MySQL Server
sudo systemctl restart mysql
```

## ğŸ‘¥ Team Members

- **DuyÃªn**: Registration system (signup feature)
- ****: Login system
- ****: Game logic
- ****: UI/UX

## ï¿½ğŸ“ License

Dá»± Ã¡n mÃ´n há»c IT4062 - Network Programming

---

**Note**: Dá»± Ã¡n há»— trá»£ cáº£ Ubuntu Native vÃ  WSL2. Xem `DATABASE_SETUP.md` Ä‘á»ƒ biáº¿t cÃ¡ch setup cho mÃ´i trÆ°á»ng cá»§a báº¡n.


